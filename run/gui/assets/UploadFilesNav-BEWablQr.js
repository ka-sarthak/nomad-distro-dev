import{r as t,j as i,w as de}from"./material-react-table-DBlzLFj3.js";import{u as G,bw as fe,cE as me,cF as ne,cG as ge,cH as P,cI as se,bd as he,N as pe,cJ as U,cK as xe,cL as ve}from"./index-Db9INgJo.js";function be(){var e=t.useRef(!0);return e.current?(e.current=!1,!0):e.current}function De({request:e,route:o,onBeforeFetch:c,onFetch:a,onError:l,reloadCount:D,...m}){const{match:n}=G(),s=fe(n),u=t.useMemo(()=>{if(e)return me(n,p=>{if(p===n[n.length-1])return e})},[e]),d=t.useMemo(()=>{if(c)return(p,g)=>c(e,g)},[c,e]),R=t.useMemo(()=>{if(a)return(p,g)=>{const M=s.current,x=ne(M,p)[M.length-1];a(x,g)}},[a,s,D]),{data:h,...j}=ge({request:u,onBeforeFetch:d,onFetch:R,onError:l,...m}),w=h&&u?ne(n,h)[n.length-1]:void 0;return{...j,data:w}}function W({path:e,request:o,response:c=g=>g,useDataForRouteParams:a={},dataIsSufficient:l=()=>!0,filterChildKeys:D=()=>!0,getChildProps:m=()=>({}),orderCompareFn:n,depth:s=0,children:u,expanded:d,onToggle:R,defaultExpanded:h,expandable:j=!1,selectable:w=!0,...p}){const g=d!==void 0,M=P(o);M!==o&&M&&console.warn("Request must not change. Might happen on hot update, otherwise: did you forget to memoize it?");const x=t.useMemo(()=>e.split("/"),[e]),K=t.useMemo(()=>x.at(-1)||"no path",[x]),oe=t.useMemo(()=>({request:typeof o=="function"?o(e):{[e]:{...o}},noImplicitFetch:!0,...a}),[o,e,a]),{fetch:S,loading:z,data:H}=De(oe),T=H&&se(e,H),J=!!T,{index:L,fullMatch:N,navigate:Y}=G(),Q=t.useMemo(()=>N.slice(L+1).map(r=>r.path).join("/"),[N,L]),y=t.useMemo(()=>N[L+x.length+1]?.path,[N,L,x]),k=Q.substring(0,e.length)===e,F=e===Q,$=P(k)!==k&&k,V=P(F)!==F&&F,A=he(),v=t.useMemo(()=>A&&se(e,A,!1),[A,e]),B=v&&l(v,K),_=t.useRef();T&&!z?_.current=T:v&&B&&(_.current=v);const f=typeof j=="function"?j(_.current):j,[ae,X]=t.useState(!1),[re,ce]=t.useState(!!h&&f),I=g?d:re,ie=t.useCallback(r=>{R&&r!==d&&R()},[d,R]),b=g?ie:ce,ue=t.useCallback(()=>Y({path:e,search:{}}),[Y,e]),E=t.useCallback(()=>{if(f)return b(!0),S()},[b,S,f]),Z=t.useCallback(()=>{b(!1),X(!1)},[b]),q=t.useCallback(()=>{I?Z():(E(),X(!0))},[I,E,Z]),ee=be();t.useEffect(()=>{if(ee&&h)return E();if(!(!$||!f)&&(b(!0),!B&&(!J||V&&!I)))return S()},[$,B,S,V,I,f,J,b,h,E,ee]);const C=_.current&&c(_.current,e),O=I||$&&f,le=F||k&&(!O||z);return i.jsx(pe,{expanded:O,selected:le,highlighted:F,onToggle:q,onSelect:w?ue:q,expandable:f,label:K,sx:{"&>.NavItem-button":{paddingLeft:s===0?void 0:(s-1)*2},"&.NavItem-root":{position:"relative"},...s>0&&{"&>.NavItem-content::before":{content:'""',position:"absolute",top:42,bottom:-4,left:16+s*16,borderLeftWidth:1,borderLeftStyle:"solid",borderLeftColor:"divider"}}},...p,children:O&&i.jsxs(i.Fragment,{children:[u,z?i.jsxs(i.Fragment,{children:[i.jsx(de,{sx:{marginLeft:s*2+4,marginY:1},children:"loading..."}),y&&!ae&&v?.[y]&&i.jsx(W,{path:`${e}/${y}`,expandable:f,request:o,response:c,useDataForRouteParams:a,dataIsSufficient:l,getChildProps:m,orderCompareFn:n,...m(v,y,e),depth:s+1},y)]}):C&&Object.keys(C).filter(r=>!r.startsWith("m_")).filter(r=>D(C,r)).toSorted((r,te)=>n?n(C,r,te):r.localeCompare(te)).map(r=>i.jsx(W,{path:`${e}/${r}`,expandable:f,request:o,response:c,useDataForRouteParams:a,dataIsSufficient:l,getChildProps:m,orderCompareFn:n,...m(C,r,e),depth:s+1},r))]})})}function Re(e,o,c){const a=e[o],l=e[c];return a.m_is==="Directory"&&l.m_is==="File"?-1:a.m_is==="File"&&l.m_is==="Directory"?1:o.localeCompare(c)}function je({type:e}){return e==="Directory"?i.jsx(xe,{}):i.jsx(ve,{})}function Fe({getChildProps:e,...o}){const{fullMatch:c,index:a}=G(),l=c.length===a+2&&c[a+1]?.path==="files",D=t.useMemo(()=>({m_request:{pagination:U},"*":"*"}),[]),m=t.useCallback(n=>{const s=n.m_response;if(!s)return!1;const u=s?.pagination;return u.page===U.page&&(u.total<=u.page_size||u.page_size>=U.page_size)},[]);return i.jsx(W,{highlighted:o.selected&&l,path:"files",variant:"menuItem",icon:void 0,request:D,dataIsSufficient:m,expandable:!0,getChildProps:(n,s,u)=>{const d=n[s];return{variant:"treeNode",icon:d.m_is&&i.jsx(je,{type:d.m_is}),alignWithExpandIcons:!0,...e?.(n,s,u)||{},expandable:d.m_is==="Directory"}},orderCompareFn:Re,...o})}export{je as D,Fe as U};
