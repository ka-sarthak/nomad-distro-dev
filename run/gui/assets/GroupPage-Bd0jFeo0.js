import{r,j as e,q as h,a3 as G,o as E,B as F,b8 as v,au as P,aP as O}from"./material-react-table-DBlzLFj3.js";import{a as D,bA as U,aZ as B,I as y,bB as V,aI as K,u as $,af as A,bC as I,V as g,T as w,C as N,k as q,l as Z,bD as z,S as H,e as J,P as L}from"./index-Db9INgJo.js";import"./@mapbox/rehype-prism-vXukC30A.js";import"./msw-BcASioFF.js";import"./react-pdf-C7aGFVic.js";import"./plotly.js-dist-min-EtOYGmgt.js";function Q({groupData:s}){const t=D(),[l,c]=r.useState(!1),[p,i]=r.useState(""),d=()=>{i(""),c(!0)},m=()=>c(!1),o=async u=>{if(!t){i("API is not available.");return}if(!s?.group_id||u!==s.group_name){i("Group name does not match.");return}try{await t.delete(`groups/${s.group_id}`)&&B("/groups")}catch{i("An error occurred while deleting the group.")}};return e.jsxs(e.Fragment,{children:[e.jsx(h,{variant:"contained",color:"warning",onClick:d,children:"Delete Group"}),e.jsx(U,{open:l,content:`To delete the group, write its name (${s?.group_name}) in the text field below.`,onClose:m,onSubmit:o,expectedName:s?.group_name,title:"Delete Group",placeholder:"Group name",error:p})]})}var f=(s=>(s.Owner="Owner",s.Member="Member",s))(f||{});function W(s){return s.members?.map(t=>({userId:t.user_id,name:t.name,affiliation:t.affiliation??"",role:t.user_id===s.owner?.user_id?f.Owner:f.Member}))??[]}function X({groupData:s,setMembersData:t,editable:l=!1}){const c=r.useMemo(()=>W(s),[s]);function p(d){const m=()=>{const o=d.getSelectedRowModel().rows.filter(a=>a.getValue("role")!==f.Owner).map(a=>a.getValue("userId")),u=s.members?.filter(a=>!o.includes(a.user_id));t(u??[]),d.resetRowSelection()};return e.jsx(e.Fragment,{children:e.jsx(G,{arrow:!0,title:"Remove selected members",children:e.jsx(E,{onClick:m,color:"inherit",children:e.jsx(K,{})})})})}const i=r.useMemo(()=>[{accessorKey:"name",header:"Name",grow:1},{accessorKey:"userId",header:"User ID",Cell:({cell:d})=>e.jsx(y,{value:d.getValue(),abbreviated:!0}),grow:1},{accessorKey:"affiliation",header:"Affiliation",grow:1},{accessorKey:"role",header:"Role"}],[]);return e.jsx(e.Fragment,{children:e.jsx(V,{columns:i,data:c,toolbarSelectActions:l?p:void 0})})}function Y({editable:s=!1}){const{reload:t}=$(),l=D(),c=A(I),[p,i]=r.useState(""),[d,m]=r.useState(!1),[o,u]=r.useState(!1),[a,S]=r.useState(c),[M,j]=r.useState(!1),[_,b]=r.useState(""),T=r.useCallback(()=>{b(""),S(c),j(!1),u(!1),t()},[t,c]),k=r.useCallback(async()=>{const n={group_name:a.group_name,members:a.members?.map(x=>x.user_id)||[]};if(!l){b("API is not available");return}try{await l.post(`groups/${a.group_id}/edit`,n,void 0)&&(b(""),j(!1),u(!1),t())}catch{b("An error occurred while saving the group.")}},[l,t,a]),C=r.useCallback((n,x)=>{S(R=>({...R,[n]:x})),j(!0)},[]);return e.jsxs(F,{children:[s&&e.jsx(v,{direction:"row",justifyContent:"flex-end",spacing:1,sx:{mb:1},children:o?e.jsxs(e.Fragment,{children:[e.jsx(h,{onClick:T,variant:"contained",children:"Cancel"}),e.jsx(h,{onClick:k,variant:"contained",disabled:!M,children:"Save"})]}):e.jsx(h,{onClick:()=>{u(!0)},variant:"contained",children:"Edit"})}),_&&e.jsx(P,{severity:"error",onClose:()=>{b("")},children:_}),e.jsx(O,{sx:{padding:1,mb:2},children:e.jsxs(v,{direction:"row",justifyContent:"space-between",alignItems:"center",sx:{flexGrow:1},children:[e.jsx(g,{label:"group name",editable:o,onChange:n=>C("group_name",n),value:a.group_name,children:e.jsx(w,{})}),e.jsx(g,{label:"owner",editable:!1,value:a?.owner?.name,children:e.jsx(w,{})}),e.jsx(g,{label:"members",editable:!1,value:a?.members?.length||"0",children:e.jsx(w,{})}),e.jsxs(g,{label:"group id",editable:!1,value:a.group_id,children:[e.jsx(y,{abbreviated:!0}),e.jsx(N,{})]})]})}),e.jsx(q,{title:e.jsx(Z,{title:"Group members",variant:"h2",sx:{mb:0,mt:0}}),primaryActions:o&&e.jsxs(e.Fragment,{children:[e.jsx(h,{variant:"contained",onClick:()=>m(!0),disabled:!o,children:"Add user"}),e.jsx(z,{open:d,onClose:()=>m(!1),onUserSelected:n=>{C("members",[...a.members||[],n.info])},withRole:!1,existingUsers:[]})]}),search:e.jsx(H,{placeholder:"Search members",value:p,onChange:n=>i(n.target.value),onClear:()=>i("")})}),e.jsx(X,{groupData:a,setMembersData:n=>{C("members",n)},editable:o}),o&&e.jsx(v,{direction:"row",justifyContent:"flex-end",sx:{mt:1},children:e.jsx(Q,{groupData:a})})]})}function oe(){const s=A(I),{user:t}=J(),l=s?.owner?.user_id===t?.profile.sub;return e.jsx(L,{children:e.jsx(Y,{editable:l})})}export{oe as default};
