import{r as t,j as i,T as fe}from"./material-react-table-Clsq1WEk.js";import{u as G,bc as de,cL as me,cM as ne,cN as ge,cO as U,cP as se,bI as he,N as pe,cQ as W,cR as xe,cS as ve}from"./index-ByzPaSZm.js";function be(){var e=t.useRef(!0);return e.current?(e.current=!1,!0):e.current}function De({request:e,route:o,onBeforeFetch:c,onFetch:a,onError:l,reloadCount:D,...m}){const{match:n}=G(),s=de(n),u=t.useMemo(()=>{if(e)return me(n,p=>{if(p===n[n.length-1])return e})},[e]),f=t.useMemo(()=>{if(c)return(p,g)=>c(e,g)},[c,e]),R=t.useMemo(()=>{if(a)return(p,g)=>{const j=s.current,x=ne(j,p)[j.length-1];a(x,g)}},[a,s,D]),{data:h,...M}=ge({request:u,onBeforeFetch:f,onFetch:R,onError:l,...m}),z=h&&u?ne(n,h)[n.length-1]:void 0;return{...M,data:z}}function w({path:e,request:o,response:c=g=>g,useDataForRouteParams:a={},dataIsSufficient:l=()=>!0,filterChildKeys:D=()=>!0,getChildProps:m=()=>({}),orderCompareFn:n,depth:s=0,children:u,expanded:f,onToggle:R,defaultExpanded:h,expandable:M=!1,selectable:z=!0,...p}){const g=f!==void 0,j=U(o);j!==o&&j&&console.warn("Request must not change. Might happen on hot update, otherwise: did you forget to memoize it?");const x=t.useMemo(()=>e.split("/"),[e]),K=t.useMemo(()=>x.at(-1)||"no path",[x]),oe=t.useMemo(()=>({request:typeof o=="function"?o(e):{[e]:{...o}},noImplicitFetch:!0,...a}),[o,e,a]),{fetch:C,loading:E,data:Q}=De(oe),O=Q&&se(e,Q),Y=!!O,{index:N,fullMatch:L,navigate:H}=G(),J=t.useMemo(()=>L.slice(N+1).map(r=>r.path).join("/"),[L,N]),y=t.useMemo(()=>L[N+x.length+1]?.path,[L,N,x]),k=J.substring(0,e.length)===e,_=e===J,P=U(k)!==k&&k,V=U(_)!==_&&_,$=he(),v=t.useMemo(()=>$&&se(e,$,!1),[$,e]),A=v&&l(v,K),F=t.useRef();O&&!E?F.current=O:v&&A&&(F.current=v);const d=typeof M=="function"?M(F.current):M,[ae,X]=t.useState(!1),[re,ce]=t.useState(!!h&&d),I=g?f:re,ie=t.useCallback(r=>{R&&r!==f&&R()},[f,R]),b=g?ie:ce,ue=t.useCallback(()=>H({path:e,search:{}}),[H,e]),T=t.useCallback(()=>{if(d)return b(!0),C()},[b,C,d]),Z=t.useCallback(()=>{b(!1),X(!1)},[b]),q=t.useCallback(()=>{I?Z():(T(),X(!0))},[I,T,Z]),ee=be();t.useEffect(()=>{if(ee&&h)return T();if(!(!P||!d)&&(b(!0),!A&&(!Y||V&&!I)))return C()},[P,A,C,V,I,d,Y,b,h,T,ee]);const S=F.current&&c(F.current,e),B=I||P&&d,le=_||k&&(!B||E);return i.jsx(pe,{expanded:B,selected:le,highlighted:_,onToggle:q,onSelect:z?ue:q,expandable:d,label:K,sx:{"&>.NavItem-button":{paddingLeft:s===0?void 0:(s-1)*2},"&.NavItem-root":{position:"relative"},...s>0&&{"&>.NavItem-content::before":{content:'""',position:"absolute",top:42,bottom:-4,left:16+s*16,borderLeftWidth:1,borderLeftStyle:"solid",borderLeftColor:"divider"}}},...p,children:B&&i.jsxs(i.Fragment,{children:[u,E?i.jsxs(i.Fragment,{children:[i.jsx(fe,{sx:{marginLeft:s*2+4,marginY:1},children:"loading..."}),y&&!ae&&v?.[y]&&i.jsx(w,{path:`${e}/${y}`,expandable:d,request:o,response:c,useDataForRouteParams:a,dataIsSufficient:l,getChildProps:m,orderCompareFn:n,...m(v,y,e),depth:s+1},y)]}):S&&Object.keys(S).filter(r=>!r.startsWith("m_")).filter(r=>D(S,r)).toSorted((r,te)=>n?n(S,r,te):r.localeCompare(te)).map(r=>i.jsx(w,{path:`${e}/${r}`,expandable:d,request:o,response:c,useDataForRouteParams:a,dataIsSufficient:l,getChildProps:m,orderCompareFn:n,...m(S,r,e),depth:s+1},r))]})})}function Re(e,o,c){const a=e[o],l=e[c];return a.m_is==="Directory"&&l.m_is==="File"?-1:a.m_is==="File"&&l.m_is==="Directory"?1:o.localeCompare(c)}function Me({type:e}){return e==="Directory"?i.jsx(xe,{}):i.jsx(ve,{})}function _e({getChildProps:e,...o}){const{fullMatch:c,index:a}=G(),l=c.length===a+2&&c[a+1]?.path==="files",D=t.useMemo(()=>({m_request:{pagination:W},"*":"*"}),[]),m=t.useCallback(n=>{const s=n.m_response;if(!s)return!1;const u=s?.pagination;return u.page===W.page&&(u.total<=u.page_size||u.page_size>=W.page_size)},[]);return i.jsx(w,{highlighted:o.selected&&l,path:"files",variant:"menuItem",icon:void 0,request:D,dataIsSufficient:m,expandable:!0,getChildProps:(n,s,u)=>{const f=n[s];return{variant:"treeNode",icon:f.m_is&&i.jsx(Me,{type:f.m_is}),alignWithExpandIcons:!0,...e?.(n,s,u)||{},expandable:f.m_is==="Directory"}},orderCompareFn:Re,...o})}export{Me as D,_e as U};
