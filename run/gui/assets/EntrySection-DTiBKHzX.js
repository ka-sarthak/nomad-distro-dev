import{r as g,j as e,a3 as P,q as C,aP as N,aR as O,B as p,aa as D,u as T,n as Q}from"./material-react-table-DBlzLFj3.js";import{u as R,R as A,m as S,ba as I,k as L,l as _,at as V,bb as q,i as W,bc as F,e as $,bd as E,be as z,ah as G,ag as J,b as Y,bf as H}from"./index-Db9INgJo.js";import{d as k,S as K,a as B,u as X,c as Z,D as U}from"./SectionProvider-D-1iO5eX.js";import{E as b}from"./Select-C8GMJQX4.js";function ee({definition:s,editable:t=!1,disableUnavailable:r=!0}){return e.jsx(K,{layout:{label:B(s.name),type:"subSectionNav",property:s.name,editable:t,disableUnavailable:r}})}function se({definition:s,editable:t=!1,disableUnavailable:r=!0,divider:d=null}){const c=X(s.name),{value:a,loading:i,change:u}=A(c);W(!i,"Loading should already be handled");const o=g.useCallback(h=>{u("upsert",h)},[u]);if(!F(t,r,a))return null;const{component:m}=Z(s);return e.jsxs(e.Fragment,{children:[d,e.jsx(U,{component:m,label:B(s.name),placeholder:"no value",editable:t,value:a,fullWidth:!m.Matrix,onChange:o})]})}function te({path:s,editable:t=!1,disableUnavailable:r=!0}){const{location:d,navigate:c}=R(),{value:a,loading:i}=A(s),u=a?.m_def,o=S.isNil(a)||S.isEmpty(a),{all_sub_sections:m,all_quantities:h}=u||{},v=g.useCallback(()=>{const n=I(d),l=n[n.length-2]?.path||"";c({path:l})},[c,d]),f=g.useMemo(()=>i||o?[]:Object.values(m),[m,i,o]),x=g.useMemo(()=>{if(i||o)return[];let n=f;return!t&&r&&(n=f.filter(l=>{const j=a[l.name];return!S.isNil(j)&&Object.keys(j).some(M=>M!=="m_def")})),n.sort((l,j)=>l.name.localeCompare(j.name))},[f,t,r,a,i,o]),w=g.useMemo(()=>{if(i||o)return[];const n=Object.values(h);return s===""?n.filter(l=>l.name!=="processing_logs"):n},[h,s,i,o]),y=g.useMemo(()=>{if(i||o)return[];let n=w;return!t&&r&&(n=w.filter(l=>!S.isNil(a[l.name]))),n.sort((l,j)=>l.name.localeCompare(j.name))},[w,t,r,a,i,o]);return i?"Loading...":x.length===0&&y.length===0?"Empty section":e.jsxs(e.Fragment,{children:[e.jsx(L,{title:e.jsx(_,{title:u.name,sx:{mt:0,mb:0}}),secondaryActions:[e.jsx(P,{title:"View JSON",children:e.jsx(C,{variant:"outlined",children:e.jsx(V,{})})},"json"),e.jsx(P,{title:"Go to parent section",children:e.jsx("span",{children:e.jsx(C,{variant:"outlined",onClick:v,disabled:s==="",children:e.jsx(q,{})},"back")})},"parent")]}),e.jsx(N,{sx:{width:"100%"},children:e.jsx(O,{sx:{display:"flex",flexDirection:"column",gap:2},children:e.jsxs(p,{sx:{flex:1,minWidth:0,display:"flex",flexDirection:"column",gap:0},children:[u.name!=="EntryArchive"&&y.length>0&&e.jsxs(b,{children:[e.jsx(_,{variant:"h3",sx:{mt:0},children:"Quantities"}),e.jsx(p,{sx:{display:"flex",flexDirection:"column"},children:e.jsx(k,{path:s,children:y.map(n=>e.jsx(p,{children:e.jsx(b,{children:e.jsx(se,{definition:n,editable:t,disableUnavailable:!0,divider:e.jsx(D,{sx:{mt:.5,mb:.5}})})})},n.name))})})]}),x.length!==0&&y.length!==0&&e.jsx(D,{sx:{my:1}}),x.length>0&&e.jsxs(b,{children:[e.jsx(_,{variant:"h3",sx:{mt:0},children:"Subsections"}),e.jsx(p,{sx:{display:"flex",flexDirection:"column",gap:1},children:e.jsx(k,{path:s,children:x.map(n=>e.jsx(b,{children:e.jsx(ee,{definition:n,editable:t,disableUnavailable:!0})},n.name))})})]})]})})})]})}function ne(s){const{search:t}=R();return t}function ae(){const{user:s}=$(),t=E(z)||{},r=E(G)||{},d=E(J)||{metadata:{}},c={...t,...r,...d.metadata},{viewers:a,viewer_groups:i,writers:u,writer_groups:o,process_running:m,published:h,with_embargo:v}=c;if(!(u&&o&&a&&i))return{canRead:!1,canWrite:!1};W(h!==void 0&&v!==void 0,"published data missing in route data");const f=s?.profile?.sub;return{canRead:h&&!v||a.map(x=>x.user_id).includes(f),canWrite:!m&&!h&&u.map(x=>x.user_id).includes(f)}}const ie=["results","metadata"];function re(){const s=T(),t=Q(s.breakpoints.up("xl"));return e.jsx(p,{sx:{width:t?`${H}px`:0,minWidth:0}})}function oe(){const{path:s}=R(),{canWrite:t}=ae(),{isPage:r}=Y(),{preview:d}=ne(),c=s.slice(8),a=t&&r&&c!==""&&!ie.find(i=>c.startsWith(i))&&!d;return e.jsx(b,{children:e.jsxs(p,{sx:{display:"flex",flexDirection:"row",gap:2,width:"100%",height:"100%"},children:[e.jsx(p,{sx:{flex:1,overflowY:"auto",paddingRight:2},children:e.jsx(te,{path:c,editable:a})}),e.jsx(re,{})]})})}const he=Object.freeze(Object.defineProperty({__proto__:null,default:oe},Symbol.toStringTag,{value:"Module"}));export{oe as E,ne as a,he as b,ae as u};
