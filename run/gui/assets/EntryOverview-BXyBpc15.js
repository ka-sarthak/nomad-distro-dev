import{r as m,j as e,o as f,q as x,ab as C,b7 as k,ac as R,ad as S,bk as U,ae as z,X as L,au as M}from"./material-react-table-DBlzLFj3.js";import{d as D,e as I,u as g,f as A,g as F,h as v,i as T,j as B,b,k as P,l as V,L as G,G as N,m as W,a as Y,E as H}from"./index-Db9INgJo.js";import{c as O,a as X}from"./utils-CNAIOzAZ.js";import{U as $,R as J,E as K,e as Q}from"./EntryDataEditor-Cy97jTf7.js";import{E as Z}from"./Select-C8GMJQX4.js";import{u as j,a as E,E as ee}from"./EntrySection-DTiBKHzX.js";import{u as w}from"./EntryContext-KoOxEAbS.js";import{_ as q}from"./tslib.es6-I3t2aBBq.js";import"./@mapbox/rehype-prism-vXukC30A.js";import"./msw-BcASioFF.js";import"./react-pdf-C7aGFVic.js";import"./plotly.js-dist-min-EtOYGmgt.js";import"./HDF5FileViewer-Dp2bCn9Q.js";import"./SectionProvider-D-1iO5eX.js";import"./List-C8YnYSw4.js";import"./Boolean-4Uc0VIHp.js";import"./Download-C4PQ4spF.js";function te(s,u,o){u===void 0&&(u=[]),o===void 0&&(o={loading:!1});var r=m.useRef(0),i=D(),n=m.useState(o),a=n[0],l=n[1],p=m.useCallback(function(){for(var y=[],t=0;t<arguments.length;t++)y[t]=arguments[t];var d=++r.current;return a.loading||l(function(c){return q(q({},c),{loading:!0})}),s.apply(void 0,y).then(function(c){return i()&&d===r.current&&l({value:c,loading:!1}),c},function(c){return i()&&d===r.current&&l({error:c,loading:!1}),c})},u);return[a,p]}function re(){const{user:s}=I(),{reload:u}=g(),{entry_id:o}=A(),{changeStack:r,clearChangeStack:i}=F(),n=v(),[a,l]=te(async()=>{const p=r.map(y=>{const t={...y},d=y.new_value;return d?.m_def&&(t.new_value={...d},delete t.new_value.m_def),t.oldValue&&delete t.oldValue,t});T(s,"User must be defined at this point"),await B(o,p,s),i(),u()},[r,i,u]);return e.jsxs(e.Fragment,{children:[e.jsx(f,{disabled:!n.hasChanges(),onClick:()=>n.undo(),children:e.jsx($,{})}),e.jsx(f,{disabled:!n.hasUnDoneChanges(),onClick:()=>n.redo(),children:e.jsx(J,{})}),e.jsx(x,{onClick:l,variant:"contained",disabled:r.length===0||a.loading,children:a.loading?"saving ...":r.length===0?"no changes to save":"save changes"})]})}function ie(s){const{url:u,navigate:o}=g(),{isPage:r}=b(),{canWrite:i}=j(),{index:n}=w(),{preview:a}=E(),[l,p]=m.useState("Default"),y=_=>{p(_.target.value)},t=m.useCallback(()=>{o({searchUpdates:{preview:a?void 0:!0}})},[o,a]),d=i&&r,c=u({path:`/uploads/${n.upload_id}/files/${n.mainfile}`}),h=[e.jsxs(C,{size:"small",sx:{m:1,minWidth:120},children:[e.jsx(k,{id:"select-layout-label",children:"Layout"}),e.jsx(R,{labelId:"select-layout-label",id:"demo-simple-select-helper",value:l,label:"Layout",onChange:y,children:e.jsx(S,{value:"Default",children:"Default"})})]},"layout")];return d&&(h.push(e.jsx(U,{children:e.jsx(z,{control:e.jsx(L,{checked:!!a,onChange:t}),label:"Preview"})},"preview")),h.push(e.jsx(re,{}))),h.push(e.jsx(x,{variant:"contained",component:G,to:c,endIcon:e.jsx(N,{}),children:"Go to File"},"file")),e.jsx(P,{title:e.jsx(V,{title:"Entry overview",sx:{mt:0,mb:0}}),secondaryActions:h,...s})}const ne={type:"container",children:[{type:"condition",query:{"quantities:any":["results.properties.catalytic"]},children:[{type:"container",sm:5,sx:{height:"650px"},title:"Catalytic reaction",children:[{type:"quantity",property:"data/name",sm:12},{type:"quantity",property:"data/reaction_name",sm:12},{type:"quantity",property:"data/reaction_type",sm:12}]}]},{type:"condition",query:{"quantities:any":["results.material.topology"]},children:[{type:"material",title:"Material",md:7,sx:{height:"650px"}}]},{type:"condition",query:{"sections:any":["pynxtools.nomad.schema.Root"]},children:[{type:"container",title:"Material",md:6,children:[{type:"quantity",property:"results/material/chemical_formula_iupac",md:6},{type:"quantity",property:"results/material/chemical_formula_reduced",md:6},{type:"quantity",property:"results/material/chemical_formula_hill",md:6},{type:"quantity",property:"results/material/chemical_formula_descriptive",md:6},{type:"quantity",property:"results/material/elements",md:6},{type:"quantity",property:"results/material/n_elements",md:6}]},{type:"container",title:"NeXus Entry",md:6,children:[{type:"quantity",property:"data/ENTRY/0/definition__field",md:6},{type:"quantity",property:"data/ENTRY/0/definition___version",md:6},{type:"quantity",property:"data/ENTRY/0/title__field",md:12},{type:"quantity",property:"data/ENTRY/0/start_time__field",md:6},{type:"quantity",property:"data/ENTRY/0/end_time__field",md:6}]},{type:"hdf5",property:"metadata/mainfile",title:"NeXus HDF5",md:12,sx:{height:"700px"}}]},{type:"condition",query:{"sections:any":["nomad.datamodel.results.SolarCell"]},children:[{type:"plot",title:"Device structure",property:"data/figures",md:5,sx:{height:"650px"}}]},{type:"condition",query:{"quantities:any":["results.method.simulation"]},children:[{type:"container",title:"Method",md:5,sx:{height:"650px"},children:[{type:"quantity",property:"results/method/simulation/program_name"},{type:"quantity",property:"results/method/simulation/program_version"},{type:"quantity",property:"results/method/simulation/dft/basis_set_type"},{type:"quantity",property:"results/method/simulation/dft/core_electron_treatment"},{type:"quantity",property:"results/method/simulation/dft/jacobs_ladder"},{type:"quantity",property:"results/method/simulation/dft/xc_functional_names"}]}]},{type:"condition",query:{"sections:any":["nomad.datamodel.results.SolarCell"]},children:[{type:"container",title:"Solar cell properties",sx:{height:"330px"},children:[{type:"quantity",property:"results/properties/optoelectronic/solar_cell/efficiency",sm:3},{type:"quantity",property:"results/properties/optoelectronic/solar_cell/fill_factor",sm:3},{type:"quantity",property:"results/properties/optoelectronic/solar_cell/open_circuit_voltage",sm:3},{type:"quantity",property:"results/properties/optoelectronic/solar_cell/short_circuit_current_density",sm:3},{type:"quantity",property:"results/properties/optoelectronic/solar_cell/illumination_intensity",sm:3},{type:"quantity",property:"results/properties/optoelectronic/solar_cell/device_area",sm:3},{type:"quantity",property:"results/properties/optoelectronic/solar_cell/device_architecture",sm:6},{type:"quantity",property:"results/properties/optoelectronic/solar_cell/absorber",sm:6},{type:"quantity",property:"results/properties/optoelectronic/solar_cell/absorber_fabrication",sm:6},{type:"quantity",property:"results/properties/optoelectronic/solar_cell/device_stack",sm:12}]}]},{type:"condition",query:{"quantities:any":["results.properties.electronic.band_structure_electronic.segment","results.properties.electronic.dos_electronic","results.properties.electronic.dos_electronic_new","results.properties.electronic.band_gap"]},children:[{type:"container",title:"Electronic properties",children:[{type:"condition",query:{"quantities:any":["results.properties.electronic.band_structure_electronic.segment"]},children:[{type:"band_structure_electronic",title:"Band structure",md:12,lg:6,xl:6,sx:{height:"450px"}}]},{type:"condition",query:{"quantities:any":["results.properties.electronic.band_structure_electronic.segment"]},children:[{type:"brillouin_zone_electronic",title:"Brillouin zone",md:12,lg:6,xl:3,sx:{height:"450px"}}]},{type:"condition",query:{"quantities:any":["results.properties.electronic.dos_electronic","results.properties.electronic.dos_electronic_new"]},children:[{type:"dos_electronic",title:"Density of states",md:12,lg:6,xl:3,sx:{height:"450px"}}]},{type:"condition",query:{"quantities:any":["results.properties.electronic.band_gap"]},children:[{type:"table",title:"Band gap",property:"results/properties/electronic/band_gap",columns:[{label:"Channel",type:"quantity",property:"index"},{type:"quantity",property:"type"},{type:"quantity",property:"value",displayUnit:"eV"},{label:"Label",type:"quantity",property:"provenance/label"}],md:"grow",sx:{height:"348px"}}]}]}]},{type:"condition",query:{"quantities:any":["results.properties.vibrational.band_structure_phonon","results.properties.vibrational.dos_phonon","results.properties.vibrational.heat_capacity_constant_volume","results.properties.vibrational.energy_free_helmholtz"]},children:[{type:"container",title:"Vibrational properties",md:12,children:[{type:"condition",query:{"quantities:any":["results.properties.vibrational.band_structure_phonon"]},children:[{type:"band_structure_vibrational",title:"Phonon Band structure",md:12,lg:6,xl:6,sx:{height:"450px"}}]},{type:"condition",query:{"quantities:any":["results.properties.vibrational.band_structure_phonon.reciprocal_cell"]},children:[{type:"brillouin_zone_vibrational",title:"Brillouin zone",md:12,lg:6,xl:3,sx:{height:"450px"}}]},{type:"condition",query:{"quantities:any":["results.properties.vibrational.dos_phonon"]},children:[{type:"dos_vibrational",title:"Phonon Density of States",md:12,lg:6,xl:3,sx:{height:"450px"}}]},{type:"condition",query:{"quantities:any":["results.properties.vibrational.heat_capacity_constant_volume"]},children:[{type:"heat_capacity",title:"Heat Capacity at Constant Volume",md:12,lg:6,xl:6,sx:{height:"450px"}}]},{type:"condition",query:{"quantities:any":["results.properties.vibrational.energy_free_helmholtz"]},children:[{type:"helmholtz_free_energy",title:"Helmholtz Free Energy",md:12,lg:6,xl:6,sx:{height:"450px"}}]}]}]},{type:"condition",query:{"quantities:any":["results.properties.geometry_optimization.energies"]},children:[{type:"container",title:"Geometry Optimization",children:[{type:"geometry_optimization",title:"Energy convergence",sx:{height:"500px"}},{type:"container",title:"Convergence results",children:[{type:"quantity",property:"results/properties/geometry_optimization/final_energy_difference",sm:4,displayUnit:"eV"},{type:"quantity",property:"results/properties/geometry_optimization/final_displacement_maximum",sm:4,displayUnit:"angstrom"},{type:"quantity",property:"results/properties/geometry_optimization/final_force_maximum",sm:4,displayUnit:"a_u_force"}]}]}]},{type:"condition",query:{"quantities:any":["results.properties.thermodynamic.trajectory"]},children:[{type:"container",title:"Thermodynamic properties",children:[{type:"trajectories",title:"Trajectory",sx:{height:"600px"}},{type:"container",title:"Molecular dynamics",children:[{type:"quantity",property:"results/properties/thermodynamic/trajectory/0/provenance/molecular_dynamics/time_step",sm:4,displayUnit:"fs"},{type:"quantity",property:"results/properties/thermodynamic/trajectory/0/provenance/molecular_dynamics/ensemble_type",sm:4}]}]}]},{type:"condition",query:{"quantities:any":["results.properties.mechanical.energy_volume_curve","results.properties.mechanical.bulk_modulus","results.properties.mechanical.shear_modulus"]},children:[{type:"container",title:"Mechanical properties",children:[{type:"energy_volume_curve",title:"Energy volume curve",lg:12,sx:{height:"610px"}},{type:"condition",query:{"quantities:any":["results.properties.mechanical.bulk_modulus"]},children:[{type:"table",title:"Bulk modulus",property:"results/properties/mechanical/bulk_modulus",columns:[{type:"quantity",property:"type"},{type:"quantity",property:"value",displayUnit:"GPa"}],md:12,lg:"grow",sx:{height:"610px"}}]},{type:"condition",query:{"quantities:any":["results.properties.mechanical.shear_modulus"]},children:[{type:"table",title:"Shear modulus",property:"results/properties/mechanical/shear_modulus",columns:[{type:"quantity",property:"type"},{type:"quantity",property:"value",displayUnit:"GPa"}],md:12,lg:"grow",sx:{height:"610px"}}]}]}]},{type:"condition",query:{"quantities:any":["workflow2"]},children:[{type:"container",title:"Workflow",children:[{type:"workflow",md:12,sx:{height:"600px"}}]}]}]};function oe({layout:s,editable:u}){const o=Y(),{fullMatch:r}=g(),i=v(),[n,a]=m.useState(),l=m.useState(!0)[1],p=r[r.length-2].params.entryId,y=m.useMemo(()=>{const d={entries:{[p]:{archive:{}}}};return s&&X(s,d.entries[p].archive),d},[s,p]),t=m.useRef(!0);return t.current=!i.hasRequestBeenMade(y.entries[p].archive),m.useEffect(()=>{async function d(){if(o)try{const c=y.entries[p].archive;l(!0);const h=await o.graph(y),_=(h.entries?.[p]).archive;i.startUpdate(c),i.commitUpdate(_,h)}catch(c){a(c),i.abortUpdate()}finally{l(!1),t.current=!1}}t.current&&d()},[i,y,p,o,l]),e.jsx(Z,{children:n?e.jsx(H,{error:n}):e.jsx(K,{layout:Q(s,u),loading:t.current})})}function je(){const{canWrite:s}=j(),{preview:u}=E(),{isPage:o,isSelect:r}=b(),i=s&&o&&!u,{index:n}=w(),a=m.useMemo(()=>O(W.cloneDeep(ne),n),[n]),l=m.useMemo(()=>e.jsxs(e.Fragment,{children:[a?.children?.length===0?e.jsx(M,{severity:"info",children:"An overview for this entry could not be automatically created."}):e.jsx(oe,{layout:a,editable:i}),r&&e.jsx(ee,{})]}),[i,r,a]);return e.jsxs(e.Fragment,{children:[o&&e.jsx(ie,{}),l]})}export{je as default};
