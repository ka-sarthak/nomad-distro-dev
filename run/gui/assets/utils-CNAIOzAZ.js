import{i as _,n as q,o as b,m as a}from"./index-Db9INgJo.js";const p={m_request:{directive:"plain",include_definition:"both",exclude:["*"]},m_def:q};function y(e={},t){if(typeof e!="object"||e===null)throw new TypeError("conditions must be a plain object");return Object.entries(e).every(([i,r])=>{const o=i.lastIndexOf(":");if(o===-1)throw new Error(`Condition key "${i}" must contain a ':' separating the JMESPath and operator`);const d=i.slice(0,o),n=i.slice(o+1).trim().toLowerCase(),s=b.search(t,d),c=Array.isArray(r)?r:[r],l=Array.isArray(s)?s:[s],u=c.map(v=>l.includes(v));switch(n){case"any":return u.some(Boolean);case"all":return u.every(Boolean);case"none":return u.every(v=>!v);default:throw new Error(`Unsupported operator "${n}" in condition key "${i}" (use any | all | none)`)}})}function g(e,t){if(!(!e||!t)){if(e.type!=="condition")return e;if(y(e.query,t))return e.children}}function w(e){e.type==="brillouin_zone_electronic"?e.request={results:{properties:{electronic:{band_structure_electronic:{segment:{m_request:{directive:"resolved",exclude:["occupations"]}},reciprocal_cell:{m_request:{directive:"resolved"}}}}}}}:e.type=="brillouin_zone_vibrational"?e.request={results:{properties:{vibrational:{band_structure_phonon:{segment:{m_request:{directive:"resolved",exclude:["occupations"]}},reciprocal_cell:{m_request:{directive:"resolved"}}}}}}}:e.type==="band_structure_electronic"?e.request={results:{properties:{electronic:{band_structure_electronic:{segment:{m_request:{directive:"resolved",exclude:["occupations"]}},reciprocal_cell:{m_request:{directive:"resolved"}}}}}}}:e.type==="band_structure_vibrational"?e.request={results:{properties:{vibrational:{band_structure_phonon:{segment:{m_request:{directive:"resolved",exclude:["occupations"]}},reciprocal_cell:{m_request:{directive:"resolved"}}}}}}}:e.type==="material"?e.request={results:{material:"*"}}:e.type==="dos_electronic"?e.request={results:{properties:{electronic:{dos_electronic:{m_request:{directive:"resolved"}},dos_electronic_new:{data:{energies:{m_request:{directive:"resolved"}},total:{m_request:{directive:"resolved"}},energy_fermi:"*",energy_ref:"*",spin_channel:"*",band_gap:{m_request:{directive:"resolved"}}}}}}}}:e.type=="dos_vibrational"?e.request={results:{properties:{vibrational:{dos_phonon:{m_request:{directive:"resolved"}}}}}}:e.type=="heat_capacity"?e.request={results:{properties:{vibrational:{heat_capacity_constant_volume:{heat_capacities:{m_request:{directive:"resolved"}},temperatures:{m_request:{directive:"resolved"}}}}}}}:e.type==="helmholtz_free_energy"?e.request={results:{properties:{vibrational:{energy_free_helmholtz:{energies:{m_request:{directive:"resolved"}},temperatures:{m_request:{directive:"resolved"}}}}}}}:e.type==="geometry_optimization"?e.request={results:{properties:{geometry_optimization:{energies:{m_request:{directive:"resolved"}}}}}}:e.type==="trajectories"?e.request={results:{properties:{thermodynamic:{trajectory:{temperature:{m_request:{directive:"resolved"}},pressure:{m_request:{directive:"resolved"}},energy_potential:{m_request:{directive:"resolved"}},available_properties:{m_request:{directive:"resolved"}}}}}}}:e.type=="workflow"?e.request={workflow2:{inputs:{m_request:{directive:"resolved",depth:5}},outputs:{m_request:{directive:"resolved",depth:5}},tasks:{m_request:{directive:"resolved",depth:5}}}}:e.type==="energy_volume_curve"&&(e.request={results:{properties:{mechanical:{energy_volume_curve:{m_request:{directive:"resolved"}}}}}})}function f(e,t){const i=g(e,t);if(i)return Array.isArray(i)?i.map(r=>f(r,t)).filter(r=>r!==void 0).flat():(e=i,w(e),"children"in e&&Array.isArray(e.children)&&(e.children=e.children.map(r=>f(r,t)).filter(r=>r!==void 0).flat()),e)}function x(){return{exclude:["files","text_search_contents"]}}function m(e,t){const i=(r,o,d=[])=>{for(const[n,s]of Object.entries(o)){const c=[...d,n];if(a.has(r,n)){const l=r[n];if(a.isObject(l)&&a.isObject(s))i(l,s,c);else if(!a.isEqual(l,s))throw new Error(`Conflicting layout data requests for the same property. Conflict detected at path: ${c.join(".")}`)}}};i(e,t),a.merge(e,t)}function h(e,t){Object.assign(t,p);function i(r,o,d){const n={};let s=n;_(o!==void 0,'Property layout without "property" key.'),o.split("/").forEach((c,l,u)=>{a.isInteger(Number(c))||(l===u.length-1?s[c]=r:(s[c]===void 0&&(s[c]={...p}),s=s[c]))}),m(d,n)}if(e.children)for(const r of e.children)h(r,t);if(e.type==="quantity"||e.type==="richText"||e.type==="imagePreview"||e.type==="plot"||e.type=="hdf5")_(!!e.property,"Property layout items must define a property"),i("*",e.property,t);else if(e.type==="subSection"){const r={...p};h(e.layout,r),i(r,e.property,t)}else if(e.type==="table"){const r={...p};e.columns.forEach(o=>{i("*",o.property,r)}),i(r,e.property,t)}else e.request!==void 0&&m(t,e.request)}export{h as a,f as c,x as g};
